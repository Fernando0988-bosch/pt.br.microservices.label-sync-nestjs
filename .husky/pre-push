#!/usr/bin/env sh

echo "ğŸ§ª Executando testes antes do push..."

# Verificar se hÃ¡ commits anteriores e origin/main existe
if git rev-parse --verify origin/main >/dev/null 2>&1; then
  # origin/main existe, executar affected test
  echo "ğŸ“Š Executando testes affected..."
  npx nx affected:test --coverage --base=origin/main --head=HEAD --maxWorkers=1
else
  # origin/main nÃ£o existe, executar testes das libs principais
  echo "ğŸ“Š Executando testes das bibliotecas principais..."
  npx nx run-many --target=test --projects=auth,rabbitmq,common --coverage --maxWorkers=1
fi

# Se os testes falharem, ainda permitir push (apenas avisar)
if [ $? -ne 0 ]; then
  echo "âš ï¸  Alguns testes falharam, mas permitindo push..."
  echo "ğŸ’¡ Corrija os testes apÃ³s o push"
fi
